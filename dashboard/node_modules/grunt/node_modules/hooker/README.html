<h1 id="JavaScript_Hooker">JavaScript Hooker</h1>
<p>Monkey-patch (hook) functions for debugging and stuff.</p>
<h2 id="Getting_Started">Getting Started</h2>
<p>This code should work just fine in Node.js:</p>
<p>First, install the module with: <code>npm install hooker</code></p>
<pre><code class="javascript"><span class="keyword">var</span> hooker = <span class="built_in">require</span>(<span class="string">'hooker'</span>);
hooker.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  console.log(<span class="built_in">arguments</span>.length + <span class="string">" arguments passed"</span>);
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// logs: "3 arguments passed", returns 7</span>
</code></pre>
<p>Or in the browser:</p>
<pre><code class="html"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"dist/ba-hooker.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  console.log(<span class="built_in">arguments</span>.length + <span class="string">" arguments passed"</span>);
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// logs: "3 arguments passed", returns 7</span>
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre>
<p>In the browser, you can attach Hooker’s methods to any object.</p>
<pre><code class="html"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="keyword">this</span>.exports = Bocoup.utils;
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"dist/ba-hooker.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
Bocoup.utils.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  console.log(<span class="built_in">arguments</span>.length + <span class="string">" arguments passed"</span>);
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// logs: "3 arguments passed", returns 7</span>
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre>
<h2 id="Documentation">Documentation</h2>
<h3 id="hooker-hook">hooker.hook</h3>
<p>Monkey-patch (hook) one or more methods of an object.</p>
<h4 id="Signature:">Signature:</h4>
<p><code>hooker.hook(object, [ props, ] [options | prehookFunction])</code></p>
<h4 id="props"><code>props</code></h4>
<p>The optional <code>props</code> argument can be a method name, array of method names or null. If null (or omitted), all enumerable methods of <code>object</code> will be hooked.</p>
<h4 id="options"><code>options</code></h4>
<ul>
<li><code>pre</code> - (Function) a pre-hook function to be executed before the original function. Arguments passed into the method will be passed into the pre-hook function as well.</li>
<li><code>post</code> - (Function) a post-hook function to be executed after the original function. The original function’s result is passed into the post-hook function as its first argument, followed by the method arguments.</li>
<li><code>once</code> - (Boolean) if true, auto-unhook the function after the first execution.</li>
<li><code>passName</code> - (Boolean) if true, pass the name of the method into the pre-hook function as its first arg (preceding all other arguments), and into the post-hook function as the second arg (after result but preceding all other arguments).</li>
</ul>
<h4 id="Returns:">Returns:</h4>
<p>An array of hooked method names.</p>
<h3 id="hooker-unhook">hooker.unhook</h3>
<p>Un-monkey-patch (unhook) one or more methods of an object.</p>
<h4 id="Signature:-1">Signature:</h4>
<p><code>hooker.unhook(object [, props ])</code></p>
<h4 id="props-1"><code>props</code></h4>
<p>The optional <code>props</code> argument can be a method name, array of method names or null. If null (or omitted), all methods of <code>object</code> will be unhooked.</p>
<h4 id="Returns:-1">Returns:</h4>
<p>An array of unhooked method names.</p>
<h3 id="hooker-orig">hooker.orig</h3>
<p>Get a reference to the original method from a hooked function.</p>
<h4 id="Signature:-2">Signature:</h4>
<p><code>hooker.orig(object, props)</code></p>
<h3 id="hooker-override">hooker.override</h3>
<p>When a pre- or post-hook returns the result of this function, the value<br>passed will be used in place of the original function’s return value. Any<br>post-hook override value will take precedence over a pre-hook override value.</p>
<h4 id="Signature:-3">Signature:</h4>
<p><code>hooker.override(value)</code></p>
<h3 id="hooker-preempt">hooker.preempt</h3>
<p>When a pre-hook returns the result of this function, the value passed will<br>be used in place of the original function’s return value, and the original<br>function will NOT be executed.</p>
<h4 id="Signature:-4">Signature:</h4>
<p><code>hooker.preempt(value)</code></p>
<h3 id="hooker-filter">hooker.filter</h3>
<p>When a pre-hook returns the result of this function, the context and<br>arguments passed will be applied into the original function.</p>
<h4 id="Signature:-5">Signature:</h4>
<p><code>hooker.filter(context, arguments)</code></p>
<h2 id="Examples">Examples</h2>
<p>See the unit tests for more examples.</p>
<pre><code class="javascript"><span class="keyword">var</span> hooker = <span class="built_in">require</span>(<span class="string">'hooker'</span>);
<span class="comment">// Simple logging.</span>
hooker.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  console.log(<span class="built_in">arguments</span>.length + <span class="string">" arguments passed"</span>);
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// logs: "3 arguments passed", returns 7</span>

hooker.unhook(<span class="built_in">Math</span>, <span class="string">"max"</span>); <span class="comment">// (This is assumed between all further examples)</span>
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// 7</span>

<span class="comment">// Returning hooker.override(value) overrides the original value.</span>
hooker.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">0</span>) {
    <span class="keyword">return</span> hooker.override(<span class="number">9000</span>);
  }
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// 7</span>
<span class="built_in">Math</span>.max() <span class="comment">// 9000</span>

<span class="comment">// Auto-unhook after one execution.</span>
hooker.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, {
  once: <span class="literal">true</span>,
  pre: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    console.log(<span class="string">"Init something here"</span>);
  }
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// logs: "Init something here", returns 7</span>
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// 7</span>

<span class="comment">// Filter `this` and arguments through a pre-hook function.</span>
hooker.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, {
  pre: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> args = [].map.call(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span><span class="params">(num)</span> {</span>
      <span class="keyword">return</span> num * <span class="number">2</span>;
    });
    <span class="keyword">return</span> hooker.filter(<span class="keyword">this</span>, args); <span class="comment">// thisValue, arguments</span>
  }
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// 14</span>

<span class="comment">// Modify the original function's result with a post-hook function.</span>
hooker.hook(<span class="built_in">Math</span>, <span class="string">"max"</span>, {
  post: <span class="function"><span class="keyword">function</span><span class="params">(result)</span> {</span>
    <span class="keyword">return</span> hooker.override(result * <span class="number">100</span>);
  }
});
<span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>) <span class="comment">// 700</span>

<span class="comment">// Hook every Math method. Note: if Math's methods were enumerable, the second</span>
<span class="comment">// argument could be omitted. Since they aren't, an array of properties to hook</span>
<span class="comment">// must be explicitly passed. Non-method properties will be skipped.</span>
<span class="comment">// See a more generic example here: http://bit.ly/vvJlrS</span>
hooker.hook(<span class="built_in">Math</span>, <span class="built_in">Object</span>.getOwnPropertyNames(<span class="built_in">Math</span>), {
  passName: <span class="literal">true</span>,
  pre: <span class="function"><span class="keyword">function</span><span class="params">(name)</span> {</span>
    console.log(<span class="string">"=&gt; Math."</span> + name, [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>));
  },
  post: <span class="function"><span class="keyword">function</span><span class="params">(result, name)</span> {</span>
    console.log(<span class="string">"&lt;= Math."</span> + name, result);
  }
});

<span class="keyword">var</span> result = <span class="built_in">Math</span>.max(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);
<span class="comment">// =&gt; Math.max [ 5, 6, 7 ]</span>
<span class="comment">// &lt;= Math.max 7</span>
result <span class="comment">// 7</span>

result = <span class="built_in">Math</span>.ceil(<span class="number">3.456</span>);
<span class="comment">// =&gt; Math.ceil [ 3.456 ]</span>
<span class="comment">// &lt;= Math.ceil 4</span>
result <span class="comment">// 4</span>
</code></pre>
<h2 id="Contributing">Contributing</h2>
<p>In lieu of a formal styleguide, take care to maintain the existing coding style. Add unit tests for any new or changed functionality. Lint and test your code using <a href="https://github.com/cowboy/grunt">grunt</a>.</p>
<p><em>Also, please don’t edit files in the “dist” subdirectory as they are generated via grunt. You’ll find source code in the “lib” subdirectory!</em></p>
<h2 id="Release_History">Release History</h2>
<p>2012/01/09 - v0.2.3 - First official release.</p>
<h2 id="License">License</h2>
<p>Copyright (c) 2012 “Cowboy” Ben Alman<br>Licensed under the MIT license.<br><a href="http://benalman.com/about/license/">http://benalman.com/about/license/</a></p>

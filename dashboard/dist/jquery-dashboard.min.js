!function(a){function b(b){b=b||{};var c={$document:a(document),$body:a(document.body),$logoTheme:a("#logo-theme"),$logoImg:a("#logo_img"),$navSlideBtn:a("#nav_slide_btn"),$navPanel:a("#nav_panel"),$navPanelUsername:a("#nav_panel_username"),$navPanelUsernameIcon:a("#nav_panel_username .panel-username-icon"),$navPanelDetail:a("#nav_panel_detail"),$searchLabel:a("#sidenav_search_label"),$searchInput:a("#sidenav_search_input"),$sidenav:a("#sidenav"),$sidenavHome:a("#sidenav_item_home"),$sidenavItemLinks:a([]),$sidenavCollectList:a("#sidenav_collect_list"),$content:a("#content"),$sidenavItems:a(".sidenav-item-link"),$headStationMsg:a("#head-station-msg"),$headStationMsgNum:a("#nav-msg-num"),$headStationMsgWrapper:a("#station-msg-num-wrapper"),defaultTheme:a.cookie("SHOP_THEME"),defaultSidenav:a.cookie("SHOP_SIDENAV"),defaultCollect:a.cookie("SHOP_COLLECTION")||b.defaultCollectList,currentOn:"default",$robot:a("#popover-robot"),$navChangeListeners:b.navChangeListeners||[]};a("._btn-expand").click(function(){a(this).hide().nextAll().show(),a("._btn-expand-up").show()}),a("._btn-expand-up").click(function(){a("._btn-expand").nextAll().hide(),a("._btn-expand").show()}),a(".home-nav-item").hover(function(){a(".nav-reply-content").show()},function(){a(".nav-reply-content").hide()});var d=function(b){b=b||{},this.config=a.extend(c,b),this.sidenavType="default",this.curSlectedLinkEle,this.curCollect=[],this.config.logo={"default":{grey:{logo:"http://shop.meilishuo.com/shop/static/img/common/logo_grey.png",css:"theme-grey"},dark:{logo:"http://shop.meilishuo.com/shop/static/img/common/logo_dark.png",css:"theme-dark"},red:{logo:"http://shop.meilishuo.com/shop/static/img/common/logo_red.png",css:"theme-red"}},vip:{grey:{logo:"http://shop.meilishuo.com/shop/static/img/vip/vip_logo.png",css:"theme-grey"},dark:{logo:"http://shop.meilishuo.com/shop/static/img/vip/vip_logo.png",css:"theme-dark"},red:{logo:"http://shop.meilishuo.com/shop/static/img/vip/vip_logo.png",css:"theme-red"}}}};return d.prototype={init:function(){this.setDefault(),this.eventBind()},setDefault:function(){this.config.$sidenavItemLinks=this.config.$sidenav.find(".sidenav-item-link"),this.pinyinEngine=a.fn.pinyinEngine(),this.setNavLinkView(window.location.pathname+window.location.hash),this.setCollect(this.config.defaultCollect),this.setTheme(this.config.defaultTheme||"grey"),"none"==this.config.defaultSidenav&&this.changeNavType({hideLinkGroup:!0})},setCollect:function(a){for(var b=this,a=a||"",c=a.split(","),d=0;d<c.length;d++)b.addCollect(c[d])},getCollectHTML:function(b){var b=b||{},c=(b.ele,a(b.ele).attr("href")),d=a(b.ele).find(".link-text").text();return'<dd href="'+c+'" class="sidenav-collect-link"><i class="fa">·</i><span class="link-text">'+d+'</span><i class="delete-collect right fa fa-close"></i></dd>'},deleteCollect:function(b,c){var d=this,e=d.getNavByLink(b),f=[];if(e&&e.ele&&"normal"==e.type&&a.inArray(b,d.curCollect)>-1){a(e.ele).removeClass("collect"),a(c).remove();for(var g=0;g<d.curCollect.length;g++)d.curCollect[g]!=b&&f.push(d.curCollect[g]);d.curCollect=f,a.cookie("SHOP_COLLECTION",d.curCollect.join(","),{expires:365,path:"/"}),0==d.curCollect.length&&d.config.$sidenavCollectList.hide()}},addCollect:function(b){var c,d=this,e=d.getNavByLink(b);e&&e.ele&&"normal"==e.type&&-1==a.inArray(b,d.curCollect)&&(c=d.getCollectHTML(e),d.config.$sidenavCollectList.show().find(".sidenav-collect-link-group").append(c),a(e.ele).addClass("collect"),d.curCollect.push(b),a.cookie("SHOP_COLLECTION",d.curCollect.join(","),{expires:365,path:"/"}))},changeNavType:function(b){var c=this,b=b||{};c.sidenavType="default"==this.sidenavType?"none":"default",c.config.$sidenav.find(".sidenav-item-link").show(),c.config.$body.toggleClass("sidenav-none").toggleClass("sidenav-default"),c.config.$navSlideBtn.toggleClass("fa-caret-left").toggleClass("fa-caret-right"),c.config.$document.find(".sidenav-none .sidenav-item.active").removeClass("active"),b.hideLinkGroup||c.config.$document.find(".sidenav-none .sidenav-item-active").addClass("active"),c.config.$sidenavCollectList.removeClass("active"),a(c).trigger("changeNav",b),a.cookie("SHOP_SIDENAV",c.sidenavType,{expires:365,path:"/"}),a(c.config.$navChangeListeners).each(function(b,c){a(c).trigger("navChange")})},isNavFold:function(){return a("body").hasClass("sidenav-none")},setTheme:function(b){var c,d=this.config.logo[this.config.currentOn||"default"][b];d&&(this.config.$document.find("html").removeClass("theme-grey").removeClass("theme-dark").removeClass("theme-red").addClass(d.css),this.config.$logoImg.attr({src:d.logo}),a(c).trigger("setTheme",{theme:b}),a.cookie("SHOP_THEME",b,{expires:365,path:"/"}))},getNavByLink:function(b){var c,d,e=this,f=!1,g=function(a,b){return b&&b.indexOf("?")>-1&&(b=b.substr(0,b.indexOf("?"))),a&&a.indexOf&&a.indexOf(b)>-1};return e.config.$sidenavItemLinks.each(function(e,h){return c=a(h),curItemLink=c.attr("href"),g(b,curItemLink)?(f=!0,d={ele:c,type:"normal"},!1):void 0}),!f&&g(b,e.config.$sidenavHome.attr("href"))&&(d={ele:e.config.$sidenavHome,type:"home"}),d},setNavLinkView:function(a,b){var c=this,d=!b,a=a||window.location.pathname+window.location.hash,e=c.getNavByLink(a),f="none"==c.sidenavType;e&&"normal"==e.type?c.selectedNavLink(e.ele,{noJump:d,noNeedActive:!!f}):e&&"home"==e.type&&c.selectedHome()},selectedHome:function(){var a=this;a.config.$sidenav.find(".sidenav-item.active").removeClass("active"),a.config.$sidenav.find(".sidenav-item-link.selected").removeClass("selected"),a.config.$sidenav.find(".sidenav-item-active").removeClass("sidenav-item-active"),a.config.$sidenavHome.addClass("active"),a.config.$sidenavHome.find(".sidenav-item-title").addClass("selected"),a.curSlectedLinkEle=a.config.$sidenavHome},selectedNavLink:function(b,c){var d=this,c=c||{},e=a(b),f=e.attr("href");e&&e.hasClass&&e.hasClass("sidenav-item-link")?(d.config.$sidenav.find(".sidenav-item.active").removeClass("active"),d.config.$sidenav.find(".sidenav-item-active").removeClass("sidenav-item-active"),d.config.$sidenav.find(".sidenav-item-link.selected").removeClass("selected"),d.config.$sidenavHome.find(".sidenav-item-title").removeClass("selected"),d.config.$sidenav.find(".candidate-selected").removeClass("candidate-selected"),e.addClass("selected"),e.parents(".sidenav-item").addClass("sidenav-item-active"),c&&c.noNeedActive||e.parents(".sidenav-item").addClass("active"),f&&!c.noJump&&(window.location.href=f),d.curSlectedLinkEle=e):d.selectedHome()},searchHanzi:function(a,b){var c=!1;return this.pinyinEngine.resetCache(),this.pinyinEngine.setCache([a],!c),this.pinyinEngine.search(b,function(a){c=a}),c},searchNav:function(b){var c=this;b&&(c.searchedItemLinks=[],this.config.$sidenavItems.removeClass("candidate-selected"),this.config.$sidenavItemLinks.each(function(d,e){var f=a(e),g=f.text(),h=c.searchHanzi(g,b);g&&h?(f.show(),c.searchedItemLinks.push(f[0])):f.hide()}),c.searchedItemLinks.length&&a(c.searchedItemLinks[0]).addClass("candidate-selected"))},isWindowHidden:function(){var a="hidden"in document?"hidden":function(){var a=null;return["webkit","moz","ms","o"].forEach(function(b){return b+"Hidden"in document?a=b+"Hidden":void 0}),a}();return a?document[a]:!1},loopMessage:{loopTime:3e4,stageMin:1e4,stageMax:6e4,incLooptime:function(){var a,b=this.loopMessage.loopTime,c=this.loopMessage.stageMax;return a=b+5e3,a>c?(this.loopMessage.loopTime=c,c):(this.loopMessage.loopTime=a,a)},decLooptime:function(){var a,b=this.loopMessage.loopTime,c=this.loopMessage.stageMin;return a=b-5e3,c>a?(this.loopMessage.loopTime=c,c):(this.loopMessage.loopTime=a,a)}},setMessageLoop:function(){var b=this;if(1==b.config.$headStationMsg.length){var c,d=null,e=function(f){d=setTimeout(function(){var d=b.loopMessage.loopTime,f=b.isWindowHidden();e(d),f||a.get("/data/message/stationmsg",function(a){0==a.code&&(a.info.new_unread_num>0?(1==a.info.new_unread_num?b.config.$headStationMsgWrapper.html(a.info.message||'您有<span class="color-red red_f">1</span>新消息！'):b.config.$headStationMsgWrapper.html('您有<span class="color-red red_f">'+a.info.new_unread_num+"</span>新消息！"),b.config.$headStationMsgNum.text(a.info.unread_num),b.config.$headStationMsgNum.show(),b.config.$headStationMsg.slideDown("normal"),clearTimeout(c),c=setTimeout(function(){b.config.$headStationMsg.slideUp("normal")},5e3),b.loopMessage.decLooptime.apply(b)):b.loopMessage.incLooptime.apply(b))},"json")},f)};e(0)}},eventBind:function(){var b,c=this;c.config.$navSlideBtn.on("click",function(a){c.changeNavType({hideLinkGroup:!0})}),c.config.$navPanel.on("mouseenter",function(a){a.stopPropagation(),c.config.$navPanelDetail.addClass("actived"),c.config.$navPanelUsernameIcon.addClass("fa-chevron-up").removeClass("fa-chevron-down")}),c.config.$navPanel.on("mouseleave",function(a){a.stopPropagation(),c.config.$navPanelDetail.removeClass("actived"),c.config.$navPanelUsernameIcon.addClass("fa-chevron-down").removeClass("fa-chevron-up")}),c.config.$body.on("click",function(a){c.config.$navPanelDetail.removeClass("actived"),c.config.$navPanelUsernameIcon.addClass("fa-chevron-down").removeClass("fa-chevron-up")}),c.config.$navPanelDetail.on("click",function(a){a.stopPropagation()}),c.config.$sidenavHome.on("click",function(b){var d=a(this),e=d.attr("href");c.selectedHome(),e&&(window.location.href=e)}),c.config.$sidenav.on("click",".sidenav-item",function(b){var d=a(this);d.hasClass("active")?d.removeClass("active"):(c.config.$sidenav.find(".sidenav-item.active").removeClass("active"),d.addClass("active"))}),c.config.$sidenav.on("click",".sidenav-item-link",function(b){var d=a(this),e=d.data("target-blank");1!=e&&(b.preventDefault(),c.selectedNavLink(d))}),c.config.$sidenav.on("click",".sidenav-item-link-group",function(a){a.stopPropagation()}),c.config.$content.on("click",function(a){c.config.$searchInput.removeClass("active"),c.config.$document.find(".sidenav-none .sidenav-item.active").removeClass("active"),c.config.$document.find(".sidenav-none .sidenav-collect.active").removeClass("active")}),c.config.$searchLabel.on("click",function(){c.config.$searchInput.toggleClass("active").focus()}),c.config.$logoTheme.on("click",function(b){var d=a(b.target),e=d.data("theme");e&&(c.config.$logoTheme.find(".active").removeClass("active"),c.setTheme(e),d.addClass("active"))}),c.config.$searchInput.on("keyup",function(d){var e=13,f=38,g=40,h=a(this).val().replace(/(\s+)|(\s+$)/g,"");d.keyCode!=e&&d.keyCode!=f&&d.keyCode!=g&&("none"==c.sidenavType&&c.changeNavType(),h||""!==h?(c.config.$sidenav.find(".sidenav-item").addClass("active"),clearTimeout(b),b=setTimeout(function(){c.searchNav(h)},100)):c.config.$sidenav.find(".sidenav-item-link").show(),c.config.$sidenav.addClass("searching"))}),c.config.$searchInput.on("keyup",function(b){var d=13,e=38,f=40,g=c.searchedItemLinks;if(g&&g.length){var h=a(".sidenav-item-link.candidate-selected"),i=h[0],j=g.length,k=g.indexOf(i),l=a(g[k+1]),m=a(g[k-1]);switch(b.keyCode){case d:h.trigger("click");break;case f:if(2>j)break;l.length&&(h.removeClass("candidate-selected"),l.addClass("candidate-selected"));break;case e:if(2>j)break;m.length&&(h.removeClass("candidate-selected"),m.addClass("candidate-selected"))}}}),c.config.$searchInput.on("focus",function(a){c.config.$searchInput.addClass("active")}),c.config.$searchInput.on("blur",function(a){setTimeout(function(){c.config.$sidenav.removeClass("searching"),c.config.$searchInput.removeClass("active"),c.config.$sidenav.find(".sidenav-item-link").show(),c.selectedNavLink(c.curSlectedLinkEle,{noJump:!0})},100)}),c.config.$sidenav.on("click",".sidenav-collect",function(b){var c=a(this);c.toggleClass("active")}),c.config.$sidenav.on("click",".sidenav-collect-link-group",function(a){a.stopPropagation()}),c.config.$sidenav.on("click",".sidenav-collect-link",function(b){var d=a(this),e=d.attr("href");e&&c.setNavLinkView(e,!0)}),c.config.$sidenav.on("click",".add-collect",function(b){var d=a(this),e=d.parent().attr("href");b.stopPropagation(),b.preventDefault(),c.addCollect(e)}),c.config.$sidenav.on("click",".delete-collect",function(b){var d=a(this),e=d.parent(),f=e.attr("href");b.stopPropagation(),c.deleteCollect(f,e)}),c.config.$robot.on("mouseover",function(b){a(this)})}},new d(b)}a.fn.extend({renderNav:function(a){a=a||{},a.defaultCollectList="/deal/order/,/goods/select_category/,/discount/list/,/activity/,/dc/shop/,/finance/";var c=b(a);return c.init(),c}})}(jQuery);